<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Fourth Example: Cardiac Binning for Motion-Resolved Cardiac MRI using Superior-Inferior (SI) Projections &#8212; Monalisa 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="_static/custom-navigation.css?v=899df2ba" />
    <link rel="stylesheet" type="text/css" href="_static/custom-button.css?v=35775deb" />
    <link rel="stylesheet" type="text/css" href="_static/important.css?v=8e75c088" />
    <link rel="stylesheet" type="text/css" href="_static/tip.css?v=66ef22ed" />
    <script src="_static/documentation_options.js?v=01f34227"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/custom.js?v=35170ed4"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Coil Sensitivity Map Estimation" href="2-4_coil_sensitivity_map.html" />
    <link rel="prev" title="Third Example: Respiratory Binning for Motion-Resolved Cardiac MRI using Superior-Inferior (SI) Projections" href="2-3-3_binning_respiratory.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
  <div role="main">
    
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="fourth-example-cardiac-binning-for-motion-resolved-cardiac-mri-using-superior-inferior-si-projections">
<h1>Fourth Example: Cardiac Binning for Motion-Resolved Cardiac MRI using Superior-Inferior (SI) Projections<a class="headerlink" href="#fourth-example-cardiac-binning-for-motion-resolved-cardiac-mri-using-superior-inferior-si-projections" title="Link to this heading">¶</a></h1>
<p><em>Author : Bastien Milani</em></p>
<p>The present cardiac binning procedure is implemented in the script <cite>lineMask_card_fromSI_script.m</cite>.
It returns a list of masks (one mask per bin) as a binary array of size <cite>[nBin, nLines]</cite> where <cite>nLines</cite> is
the total number of acquired lines in the sequence.</p>
<p>Each mask corresponds to a cardiac phase extracted from the superior inferior (SI) projections
acquired as the first line of each shot of a 3D-radial free running sequence <a class="footnote-reference brackets" href="#id2" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>.</p>
<p>In order to run the scripts, the SI’s must be prepared in an array named <cite>SI</cite> of size <cite>[nCh, N, nShot]</cite>
where <cite>nCh</cite> is the number of channels in the raw data, <cite>N</cite> is the number of points per acquired line,
and <cite>nShot</cite> is the total number of shots acquired during the sequence. We describe here
each section of the script.</p>
<p>This script is  similar to the script for respiratory binning, but we run sometimes some different
functions with different parameters.</p>
<section id="steps-for-cardiac-binning-using-si-projections">
<h2>Steps for Cardiac Binning using SI projections:<a class="headerlink" href="#steps-for-cardiac-binning-using-si-projections" title="Link to this heading">¶</a></h2>
<ol class="arabic">
<li><p><strong>Initialization</strong></p>
<p>Here we set some parameters to help the program to recognize correct sizes
and to inform the rest of the procedure. Enter the requested parameters
as described more in detail below. You can then run the section.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%%</span>
<span class="n">filter_type</span><span class="w">                 </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;bandPass&#39;</span><span class="p">;</span>
<span class="w">                              </span><span class="c">% &#39;bandPass&#39; for card. binning</span>

<span class="n">nMask</span><span class="w">                       </span><span class="p">=</span><span class="w"> </span><span class="mi">18</span><span class="p">;</span><span class="w"> </span><span class="c">% Should be adapted to heart_rate.</span>
<span class="n">maskWidth</span><span class="w">                   </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c">% A width of 1 expresses no overlap.</span>
<span class="w">                                  </span><span class="c">% A width of 1.2 expresses 20% overlapp.</span>

<span class="n">nSignal_to_select</span><span class="w">           </span><span class="p">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w"> </span><span class="c">% 15 to 25 for card. binning.</span>


<span class="n">signal_exploration_level</span><span class="w">    </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;medium&#39;</span><span class="p">;</span>
<span class="w">                              </span><span class="c">% &#39;leight&#39; or &#39;medium&#39; or &#39;heavy&#39;</span>

<span class="n">nCh</span><span class="w">                         </span><span class="p">=</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span>
<span class="n">N</span><span class="w">                           </span><span class="p">=</span><span class="w"> </span><span class="mi">384</span><span class="p">;</span>
<span class="n">nSeg</span><span class="w">                        </span><span class="p">=</span><span class="w"> </span><span class="mi">22</span><span class="p">;</span>
<span class="n">nShot</span><span class="w">                       </span><span class="p">=</span><span class="w"> </span><span class="mi">3870</span><span class="p">;</span>

<span class="n">nLine</span><span class="w">                       </span><span class="p">=</span><span class="w"> </span><span class="n">nSeg</span><span class="o">*</span><span class="n">nShot</span><span class="p">;</span>
<span class="n">nPt</span><span class="w">                         </span><span class="p">=</span><span class="w"> </span><span class="n">N</span><span class="o">*</span><span class="n">nLine</span><span class="p">;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><cite>filter_type</cite> must be set to <cite>bandPass</cite> for cardiac binning.</p></li>
<li><p><cite>nMask</cite> is the number of masks (or bins) that we want in the output.</p></li>
<li><p><cite>maskWidth</cite> expresses how much the bins can overlap between neighbors. A value of 1 expresses no overlap. A value of 1.2 expresses 20% overlap.</p></li>
<li><p><cite>nSignal_to_select</cite> is a number of candidate signals generated in the procedure. We will manually select among them some signals that will serve to create a phase for cardiac binning.</p></li>
<li><p><cite>signal_exploration_level</cite> expresses the number of candidates signals the automatic search is going to generate. For a modern labtop you can chose <cite>medium</cite>. For a larger computer you can chose <cite>heavy</cite>.</p></li>
<li><p><cite>nCh</cite> is the number of channels in the raw data.</p></li>
<li><p><cite>N</cite> is the number of points per acquired lines.</p></li>
<li><p><cite>nSeg</cite> is the number of segments per shot in the sequence.</p></li>
<li><p><cite>nShot</cite> is the total number of acquired shots in the sequence.</p></li>
</ul>
</li>
<li><p><strong>Constructing root-mean-squared SI for display</strong></p>
<p>This section requires no input.
It is just evaluating the root-mean-squared SI’s for a display purpose.
You can just run the section.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%% getting rmsSI from SI</span>
<span class="n">rmsSI</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">bmMriPhi_fromSI_rmsSI</span><span class="p">(</span><span class="n">SI</span><span class="p">,</span><span class="w"> </span><span class="n">nCh</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">nShot</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p><strong>Extracting one Reference Signal to Start With</strong></p>
<p>The goal of this section is to extract one reference physiological
signal to start the procedure of cardiac binning. More signals will be
generated later.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%% getting standart_reference_signal from SI</span>

<span class="p">[</span><span class="n">s_ref</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="n">t_ref</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="n">Fs_ref</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="n">nu_ref</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="n">imNav</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="n">ind_shot_min</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="n">ind_shot_max</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="n">ind_SI_min</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="n">ind_SI_max</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="n">s_reverse_flag</span><span class="w">   </span><span class="s">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">...</span>
<span class="n">bmMriPhi_fromSI_get_standart_reference_signal</span><span class="p">(</span><span class="w">  </span><span class="n">rmsSI</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                                </span><span class="n">nCh</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                                </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                                </span><span class="n">nSeg</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                                </span><span class="n">nShot</span><span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<p>Run the section and you will see a graphical interface appear.
You ca npress ctr+E to open the imcontrast interface tool of Matlab.</p>
<p>You may be able to adjust to contrast in order to see some vertical
strikes that are typical of cardiac mouvement, as on the following figure.</p>
<p>Press shift + E to freeze the chosen contrast, else it will be lost.</p>
<a class="reference internal image-reference" href="_images/cardiac_binning_01.png"><img alt="cardiac_binning_01" class="align-center" src="_images/cardiac_binning_01.png" style="width: 90%;" />
</a>
<p>You need now to define 3 pairs of lines by 6 clicks (and some possible re-adjustments)
and then close the window to terminate the section.</p>
<p>The first pair of lines is to define a horizontal window.</p>
<blockquote>
<div><ul class="simple">
<li><p>Do <cite>s + Left Click</cite> to set the left end of the window.</p></li>
<li><p>Do <cite>s + Right Click</cite> to set the right end of the window.</p></li>
</ul>
</div></blockquote>
<p>As for respiratory binning, the program is going to construct
internally the even extension of the reference signal extracted
by the present section. Observe next figure to select the left and
right end of the horizontal window so that no pathology occurs,
if possible (it is not critical but do your best).</p>
<a class="reference internal image-reference" href="_images/even_extension1.png"><img alt="Even Extension and Associated Pathologies" class="align-center" src="_images/even_extension1.png" style="width: 90%;" />
</a>
<p>In order to avoid pathologies in the even extension of the reference signal,
we will select the left and right ends (yellow vertical bars) of the
horizontal window either in two maxima of the respiratory patern, or in two minima.
You can zoom with the loop to click precisely.</p>
<p>In the case of cardiac binning,
it may be trycky to tarjet two minima or maxima. We suggest to put the vertical lines
on two white strikes. If that is too sunjective, just do your best, it is not
critical anyway.</p>
<p>Note that the left end of that horizontal window also serve to exclude the
non-steady-state acquired data.</p>
<p>Here is an example of the selection for the left and right ends of the horizontal
window.</p>
<a class="reference internal image-reference" href="_images/cardiac_binning_02.png"><img alt="cardiac_binning_02" class="align-center" src="_images/cardiac_binning_02.png" style="width: 90%;" />
</a>
<a class="reference internal image-reference" href="_images/cardiac_binning_03.png"><img alt="cardiac_binning_03" class="align-center" src="_images/cardiac_binning_03.png" style="width: 90%;" />
</a>
<p>You have now to define the lower and upper bound of the vertical window that
contains the some caracteristic patterns of cardiac motion. The best way to do it
is to select some vertical window that seems to contain some cardiac pattern
and then adjust it as described below. Make two clicks as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p>Do <cite>x + Left Click</cite> to set the lower bound of the window.</p></li>
<li><p>Do <cite>x + Right Click</cite> to set the upper end of the window.</p></li>
</ul>
</div></blockquote>
<p>After these two clicks you may see someting like this:</p>
<a class="reference internal image-reference" href="_images/cardiac_binning_04.png"><img alt="cardiac_binning_04" class="align-center" src="_images/cardiac_binning_04.png" style="width: 90%;" />
</a>
<p>The red line is the reference signal generated from the selected windows.
It is a weighted average of the grey values in the vertical window.
You have now to adjust it:</p>
<blockquote>
<div><ul class="simple">
<li><p>press the up-arrow to shift the vertical window up,</p></li>
<li><p>press the down-arrow to shift the vertical window down,</p></li>
<li><p>press the ctrl+right-arrow to increase the width of vertical window,</p></li>
<li><p>press the ctrl+left-arrow to decrease the width of vertical window,</p></li>
</ul>
</div></blockquote>
<p>You can also play with the displayed signal without chaning its values internally,
by using following keys:</p>
<blockquote>
<div><ul class="simple">
<li><p>press ctrl+up-arrow to increase the displayed amplitude of the reference signal,</p></li>
<li><p>press ctrl+down-arrow to decrease the displayed amplitude of the reference signal.</p></li>
<li><p>press ctrl+R to flip up-down the reference signal.</p></li>
</ul>
</div></blockquote>
<p>After playing with those adjustments, you may be able to end up with a reference
signal that is synchronized with the strikes due to cardiac motion. If you are lucky,
you may see someting like this:</p>
<a class="reference internal image-reference" href="_images/cardiac_binning_05.png"><img alt="cardiac_binning_05" class="align-center" src="_images/cardiac_binning_05.png" style="width: 90%;" />
</a>
<p>If the strikes due to cardiac movement are not visible, just set a vertical window
that you suspect to contain information about cardiat motion. The filtering
of the signal below may reveal some cardiac dependent signal.</p>
<p>Finally, chose a vertical window that will serve for display purpose
only in the rest of the precedure.</p>
<blockquote>
<div><ul class="simple">
<li><p>press n + left-click to select the lower bound of the display window,</p></li>
<li><p>press n + right-click to select the upper bound of the display window.</p></li>
</ul>
</div></blockquote>
<p>After those clicks, you should see someting like this:</p>
<a class="reference internal image-reference" href="_images/cardiac_binning_06.png"><img alt="cardiac_binning_06" class="align-center" src="_images/cardiac_binning_06.png" style="width: 90%;" />
</a>
<p>You can now close the windows and the chosen reference signal will
automatically be saved.</p>
</li>
<li><p><strong>Graphical Frequency Selector</strong></p>
<p>We will now bandpass filter the reference signal. Run the following section.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%% graphical frequency selector</span>
<span class="p">[</span><span class="w"> </span><span class="n">s_ref_lowPass</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="n">s_ref_bandPass</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="n">lowPass_filter</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="n">bandPass_filter</span><span class="w"> </span><span class="s">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">...</span>
<span class="n">bmMriPhi_graphical_frequency_selector</span><span class="p">(</span><span class="w">  </span><span class="n">s_ref</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                        </span><span class="n">t_ref</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                        </span><span class="n">Fs_ref</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                        </span><span class="n">nu_ref</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                        </span><span class="n">imNav</span><span class="w">   </span><span class="p">);</span>
</pre></div>
</div>
<p>You should then see the graphical frequency selector appear. In the left pannel is the
frequency spectrum of the reference signal displayed, and the right pannel
is the reference signal displayed.
On the left pannel, in the upper line of buttons, press the more right button the stretch
the frequency axis to the right until you see a similar picture like the following.</p>
<a class="reference internal image-reference" href="_images/cardiac_binning_07.png"><img alt="cardiac_binning_07" class="align-center" src="_images/cardiac_binning_07.png" style="width: 90%;" />
</a>
<p>Still on the left pannel, in the lower line of buttons, on the right, press the “&lt;&lt;&lt;” button
to decrese the value of the maximum frequency of the filter. You may have to press many times
until the effect appears on the displayed range of frequencies. You can also use the buttons
“&lt;&lt;” and “&lt;” to be more precise. Try to identify the peak arround the base frequency of
the cardiac signal, and create a lowpass filter that include that peak. Then increase the
minimum frequency of the filter to make it bandpass, so that only the frequencies arround
the base frequency of the cardiac signal are accepted by the filter. Here is an example:</p>
<a class="reference internal image-reference" href="_images/cardiac_binning_08.png"><img alt="cardiac_binning_08" class="align-center" src="_images/cardiac_binning_08.png" style="width: 90%;" />
</a>
<p>Then press the button “Filter Signal”.
The filtered signal appears then in blue on the right pannel.
You can press “Hide Yelow” to discard the reference signal.</p>
<a class="reference internal image-reference" href="_images/cardiac_binning_09.png"><img alt="cardiac_binning_09" class="align-center" src="_images/cardiac_binning_09.png" style="width: 90%;" />
</a>
<p>You can stretch the time axis in both directions using the “&lt;&lt;&lt;” and “&gt;&gt;&gt;” buttons
and navigate using the “—&gt;” and  “&lt;—” buttons to inspect the filtered
reference signal. Make sure that the signal looks like a sinusoid modulated in
amplitude and frequency, but that no harmonic of the base frequency are expressed.
There should ideally be no ringing in the filtered signal. If needed, you can
re-adjust the filter and press “Filter Signal” again,
until the filtered signal looks like a modulated sinusoid.</p>
<p>You can change the contrast of the background in the right
pannel with the imcontrast tool of Matlab by pressing the “imcontrast” button.
But once you have changed the contrast, press the “fix contrast” buton, else
the changes in contrast will be lost.</p>
<p>By adjusting the contrast, you should observe
that the filtered signal oscilated together with the vertical strikes due to
cardiac motion. This confirms that the correct peak was selected in the frequency
spectrum. If you cannot see those strikes, a good rule of thumb is that the first
peak in the frequency spectrum is due to respiratory motion, and the second
is due do cardiac motion.</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/cardiac_binning_10.png"><img alt="cardiac_binning_10" class="align-center" src="_images/cardiac_binning_10.png" style="width: 90%;" />
</a>
</div></blockquote>
<p>You can now close the window and the filter will be saved.</p>
</li>
<li><p><strong>Reformating the Filtered Signal</strong></p>
<p>Just execute the following automatic section.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%% reformated_signal_ref</span>
<span class="n">check_image</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">rmsSI</span><span class="p">(</span><span class="n">ind_SI_min</span><span class="p">:</span><span class="n">ind_SI_max</span><span class="p">,</span><span class="w"> </span><span class="p">:);</span>
<span class="n">reformated_signal_ref</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">...</span>
<span class="n">bmMriPhi_fromSI_standartSignal_to_reformatedSignal</span><span class="p">(</span><span class="w">   </span><span class="n">s_ref_bandPass</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                                      </span><span class="n">nSeg</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                                      </span><span class="n">nShot</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                                      </span><span class="n">ind_shot_min</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                                      </span><span class="n">ind_shot_max</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                                      </span><span class="n">check_image</span><span class="w">   </span><span class="p">);</span>
</pre></div>
</div>
<p>A figure appears then to show the filtered signal reformated with the correct size.
You can check on that figure that the filtered signal oscillate toghether with the
background.</p>
<a class="reference internal image-reference" href="_images/cardiac_binning_11.png"><img alt="resp_confirm" class="align-center" src="_images/cardiac_binning_11.png" style="width: 90%;" />
</a>
<p>You can close that figure and go to the next section.</p>
</li>
<li><p><strong>Looking for Signal Candidates in Order to Create a Phase</strong></p>
<p>This section is automatic and requires no input. The called functions
will creates some signal candidates that will be used hereafter to
create a phase. Just execute it and go to the next section.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%% extracting reformated_signal_list from SI</span>
<span class="k">if</span><span class="w"> </span><span class="n">nSignal_to_select</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span>
<span class="w">   </span><span class="n">nSignal_to_select_minus_1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">nSignal_to_select</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">   </span><span class="n">reformated_signal_list</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">...</span>
<span class="w">   </span><span class="n">bmMriPhi_fromSI_collect_signal_list</span><span class="p">(</span><span class="w">   </span><span class="n">filter_type</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                          </span><span class="n">t_ref</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                          </span><span class="n">nu_ref</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                          </span><span class="n">SI</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                          </span><span class="n">lowPass_filter</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                          </span><span class="n">bandPass_filter</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                          </span><span class="n">nCh</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                          </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                          </span><span class="n">nSeg</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                          </span><span class="n">nShot</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                          </span><span class="n">nSignal_to_select_minus_1</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                          </span><span class="n">signal_exploration_level</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                          </span><span class="n">ind_shot_min</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                          </span><span class="n">ind_shot_max</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                          </span><span class="n">ind_SI_min</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                                          </span><span class="n">ind_SI_max</span><span class="p">,</span><span class="k">...</span>
<span class="w">                                          </span><span class="n">s_reverse_flag</span><span class="w">   </span><span class="p">);</span>
<span class="k">else</span>
<span class="w">   </span><span class="n">reformated_signal_list</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span>
<span class="k">end</span>

<span class="n">reformated_signal_list</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cat</span><span class="p">(</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                              </span><span class="n">reformated_signal_ref</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">                              </span><span class="n">reformated_signal_list</span><span class="p">);</span>
</pre></div>
</div>
</li>
<li><p><strong>Selecting the Best Candidate Signals</strong></p>
<p>After executing the following section, you will see a sequence of figures appear
showing some candidate signales in their phase space. After closing the window
of a candidate signal, answer if you accept of reject the signal. A signal that
spins arround the center without crossing the center is considered of good
quality to evaluate a phase and should be accepted. A signal that crosses the
center is considered of bad quality to evaluate a phase and should be rejected.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%% computing card phase</span>
<span class="p">[</span><span class="n">cardPhase</span><span class="p">,</span><span class="w"> </span><span class="n">cardPhase_list</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="k">...</span>
<span class="n">bmMriPhi_signalList_to_phase</span><span class="p">(</span><span class="w">  </span><span class="n">reformated_signal_list</span><span class="w">  </span><span class="p">);</span>
</pre></div>
</div>
<p>Here is an example of candidate signal:</p>
<a class="reference internal image-reference" href="_images/cardiac_binning_12.png"><img alt="cardiac_binning_12" class="align-center" src="_images/cardiac_binning_12.png" style="width: 90%;" />
</a>
</li>
</ol>
<p>This signal is of good quality because it is not present in the center. This
should be accepted in the following dialog box:</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/cardiac_binning_13.png"><img alt="cardiac_binning_13" class="align-center" src="_images/cardiac_binning_13.png" style="width: 40%;" />
</a>
</div></blockquote>
<p>Here is another example of candidate signal:</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/cardiac_binning_14.png"><img alt="cardiac_binning_14" class="align-center" src="_images/cardiac_binning_14.png" style="width: 90%;" />
</a>
</div></blockquote>
<p>This signal is of bad quality because it present in the center. This
should be rejected in the following dialog box:</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/cardiac_binning_15.png"><img alt="cardiac_binning_15" class="align-center" src="_images/cardiac_binning_15.png" style="width: 40%;" />
</a>
</div></blockquote>
<p>After you gave an answer for every of the candidate signals,
two graph are displayed:</p>
<blockquote>
<div><ul class="simple">
<li><p>one showing each phase computed from each accepted signals. All the phases have to approximatelly agree together. That means that all signals measure the same cardiac phase.</p></li>
<li><p>another showing the combination of all phases computed from each accepted signals. That phase will be used to create the binning masks.</p></li>
</ul>
</div></blockquote>
<p>Here a are some example of these two graphs:</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/cardiac_binning_16.png"><img alt="cardiac_binning_16" class="align-center" src="_images/cardiac_binning_16.png" style="width: 90%;" />
</a>
<a class="reference internal image-reference" href="_images/cardiac_binning_17.png"><img alt="cardiac_binning_17" class="align-center" src="_images/cardiac_binning_17.png" style="width: 90%;" />
</a>
</div></blockquote>
<p>You can now close all figures and go to the last section.</p>
<ol class="arabic" start="8">
<li><p><strong>Create the Masks</strong></p>
<p>Here is the last section for cardiac binning. You can run it.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%% mask_construction</span>
<span class="n">cMask</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">bmMriPhi_phase_to_mask</span><span class="p">(</span><span class="n">cardPhase</span><span class="p">,</span><span class="w"> </span><span class="n">nMask</span><span class="p">,</span><span class="w"> </span><span class="n">maskWidth</span><span class="p">);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/cardiac_binning_18.png"><img alt="cardiac_binning_18" class="align-center" src="_images/cardiac_binning_18.png" style="width: 90%;" />
</a>
<p>The binning mask are displayed and stored in the variable cMask. Note that the first lines are
excuded by all masks, in accordance with the selection of the horizontal window at the beginning
of the script.</p>
<p>You can now save the binning mask on the disk for a future purpose.</p>
</li>
</ol>
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="id2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Piccini D, Littmann A, Nielles-Vallespin S, Zenge MO. Spiral phyllotaxis: The natural way to construct
a 3D radial trajectory in MRI: Spiral Phyllotaxis Radial 3D Trajectory. Magn Reson Med. 2011
Oct;66(4):1049–56.</p>
</aside>
</aside>
</section>
</section>


          </div>
          
        </div>
      </div>  <!-- This includes the original document content -->

    <!-- Back to Top Button -->
    <button onclick="scrollToTop()" id="back-to-top" title="Go to top">↑</button>
  </div>

      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Monalisa</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1_quick_start.html">Quick Start</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="2_contents.html">Contents</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="2-1_reconstruction_calls.html">Reconstruction Calls</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-2_mitosius_prepare.html">The Mitosius</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="2-3_binning_masks.html">Binning: Flexible Readout Rearrangement</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="2-3-1_binning_eye_1.html">First Example: Sequential Binning</a></li>
<li class="toctree-l3"><a class="reference internal" href="2-3-2_binning_eye_2.html">Second Example: Task-Based (Hi-Fi) fMRI</a></li>
<li class="toctree-l3"><a class="reference internal" href="2-3-3_binning_respiratory.html">Third Example: Respiratory Binning for Motion-Resolved Cardiac MRI using Superior-Inferior (SI) Projections</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Fourth Example: Cardiac Binning for Motion-Resolved Cardiac MRI using Superior-Inferior (SI) Projections</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="2-4_coil_sensitivity_map.html">Coil Sensitivity Map Estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-5_prescan_acquisition.html">Acquisition Guidelines for Coil Sensitivity Estimation using Prescans</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3_examples.html">Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="4_api.html">API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="5_docker.html">Docker for Monalisa</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_ack_contribution.html">Acknowledgment and Authors</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="2_contents.html">Contents</a><ul>
  <li><a href="2-3_binning_masks.html">Binning: Flexible Readout Rearrangement</a><ul>
      <li>Previous: <a href="2-3-3_binning_respiratory.html" title="previous chapter">Third Example: Respiratory Binning for Motion-Resolved Cardiac MRI using Superior-Inferior (SI) Projections</a></li>
      <li>Next: <a href="2-4_coil_sensitivity_map.html" title="next chapter">Coil Sensitivity Map Estimation</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Bastien Milani.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/2-3-4_binning_cardiac.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>