<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>The Mitosius &#8212; Monalisa 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="_static/custom-navigation.css?v=899df2ba" />
    <link rel="stylesheet" type="text/css" href="_static/custom-button.css?v=35775deb" />
    <link rel="stylesheet" type="text/css" href="_static/important.css?v=8e75c088" />
    <link rel="stylesheet" type="text/css" href="_static/tip.css?v=66ef22ed" />
    <script src="_static/documentation_options.js?v=01f34227"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "displayMath": [["$$", "$$"], ["\\[", "\\]"]]}, "TeX": {"Macros": {"coloneqq": "\\mathrel{\\mathpalette\\coloneqq@{}}", "parallel": "\\parallel"}}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/custom.js?v=35170ed4"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Binning: Flexible Readout Rearrangement" href="2-4_binning_masks.html" />
    <link rel="prev" title="Reconstruction Calls" href="2-2_reconstruction_calls.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
  <div role="main">
    
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="the-mitosius">
<h1>The Mitosius<a class="headerlink" href="#the-mitosius" title="Link to this heading">¶</a></h1>
<p>Creating the Mitosius is the last preparation step before the reconstruction. This section covers how to prepare the mitosius.</p>
<p>You have already run the coil sensitivity estimation or had an estimate of coil sensitivity by your own procedure (see the <span class="xref std std-doc">Coil Sensitivity Map Estimation</span>). You need to have access to the raw data of the acquisition (of course :)).</p>
<p>This script is designed to process Siemens raw MRI data/ISMRMRD using various monalisa functions to load raw data, initialize parameters, compute trajectory points and volume elements, normalize the data, and generate the output “mitosius”. The resulting mitosius contains raw data, the computed trajectory and the volume elements for each bin.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Keep in mind that the trajectory must be supported by the toolbox; alternatively, you can define and implement a custom trajectory following our suggestion at the end of the section (see the section <a class="reference internal" href="#custom-acquisition"><span class="std std-ref">Using a Custom Acquisition Trajectory</span></a>).</p>
</div>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">¶</a></h2>
<p>Ensure you have the following files and paths correctly set up:</p>
<ul class="simple">
<li><p>Siemens raw data file. (Or ISMRMRD file)</p></li>
<li><p>Precomputed coil sensitivity matrix (C.mat).</p></li>
<li><p>Precomputed binning mask (Mask.mat)</p></li>
</ul>
<p>Additionally, the required functions (e.g., <cite>bmTwix_info</cite>, <cite>bmTwix</cite>, <cite>bmTraj</cite>, etc.) should be available in your MATLAB environment, as these functions are internal functions in the monalisa toolkit.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you use a 3D radial trajectory, you can use <cite>bmTwix_info</cite> function to help you inspect acquisition parameters by <cite>bmTwix_info(‘/path/to/raw_data.dat’)</cite>. <cite>bmTwix_info</cite> is only a help function which is not part of the recon procedure. Sometimes, <cite>bmTwix_info</cite> may fail to read the raw data file. But there is no need to worry-you can still find your way to identify acquisition parameters.</p>
</div>
</section>
<section id="usage-instructions">
<h2>Usage instructions<a class="headerlink" href="#usage-instructions" title="Link to this heading">¶</a></h2>
<section id="define-the-paths">
<h3>Define the Paths<a class="headerlink" href="#define-the-paths" title="Link to this heading">¶</a></h3>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">%% Paths - Replace for your own case</span>
<span class="n">f</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;/your/path/to/raw_data/rawdata.dat&#39;</span><span class="p">;</span>
<span class="n">CMatPath</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;/your/path/to/C/C.mat&#39;</span><span class="p">;</span>
<span class="n">MaskPath</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;/your/path/to/Mask/Mask.mat&#39;</span><span class="p">;</span>
<span class="n">mitosiusPath</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;/your/path/to/save/mitosius/&#39;</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="load-the-raw-data">
<h3>Load the Raw Data<a class="headerlink" href="#load-the-raw-data" title="Link to this heading">¶</a></h3>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">autoFlag</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">      </span><span class="c">% Set whether the validation UI is shown</span>
<span class="c">% Create the appropriate reader based on the file extension</span>
<span class="n">reader</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">createRawDataReader</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">autoFlag</span><span class="p">);</span>
</pre></div>
</div>
<p>In our examples, we often use 3D radial trajectory. In that case, the raw data reader will check the first segment of each shot to estimate after how many nLines, steady state is reached.
For your own trajectory, you can find your own way.</p>
<p>(The image title is yet to change)</p>
<img alt="_images/SI_of_each_shot.png" src="_images/SI_of_each_shot.png" />
<p>The acquisition parameters will be extracted automatically, if possible.</p>
<img alt="_images/param_extract.png" src="_images/param_extract.png" />
<p>You can also modify the parameters manually in the “User Value” column (in yellow), for example: adjusting <cite>nShotOff</cite> according to your needs. If you want to include all the lines for reconstruction, set <cite>nShotOff = 0</cite>. Then click the “Confirm” button.</p>
</section>
<section id="add-mri-acquisition-parameters">
<h3>Add MRI Acquisition Parameters<a class="headerlink" href="#add-mri-acquisition-parameters" title="Link to this heading">¶</a></h3>
<p>Save the acquisition parameters into <cite>p</cite> and add other parameters you may need.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="n">acquisitionParams</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">selfNav_flag</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="n">p</span><span class="p">.</span><span class="n">traj_type</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;full_radial3_phylotaxis&#39;</span><span class="p">;</span>

<span class="c">% Initialize and fill in the parameters:</span>
<span class="c">% p.raw_N_u: acquisition matrix size (identified from your acquisition protocol)</span>
<span class="n">p</span><span class="p">.</span><span class="n">raw_N_u</span><span class="w">         </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">480</span><span class="p">,</span><span class="w"> </span><span class="mi">480</span><span class="p">,</span><span class="w"> </span><span class="mi">480</span><span class="p">];</span><span class="w"> </span><span class="c">% optional, just for records</span>
<span class="n">p</span><span class="p">.</span><span class="n">raw_dK_u</span><span class="w">        </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="o">./</span><span class="mi">480</span><span class="p">;</span><span class="w"> </span><span class="c">% optional, just for records</span>
</pre></div>
</div>
</section>
<section id="read-the-raw-data-and-compute-trajectory-points-volume-elements">
<h3>Read the raw data and compute trajectory points, volume elements<a class="headerlink" href="#read-the-raw-data-and-compute-trajectory-points-volume-elements" title="Link to this heading">¶</a></h3>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% Read raw data</span>
<span class="c">% get raw data without nshotoff and SI</span>
<span class="n">flagSS</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">true</span>
<span class="n">flagExcludeSI</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">true</span>
<span class="c">% flagSS: if true, filter out the non steady state shots</span>
<span class="c">% flagExcludeSI: if true, filter out the SI projections</span>
<span class="n">y_tot</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">reader</span><span class="p">.</span><span class="n">readRawData</span><span class="p">(</span><span class="n">flagSS</span><span class="p">,</span><span class="w"> </span><span class="n">flagExcludeSI</span><span class="p">);</span>

<span class="c">% compute trajectory points</span>
<span class="c">% get &#39;full_radial3_phylotaxis&#39; trajectory without nshotoff and SI</span>
<span class="n">t_tot</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">bmTraj</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="c">% alternatively you can compute your own trajectory</span>
<span class="c">% more details in &quot;Using a Custom Acquisition Trajectory&quot;</span>

<span class="c">% compute volume elements (3D full radial trajectory in this case)</span>
<span class="n">ve_tot</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="n">bmVolumeElement</span><span class="p">(</span><span class="n">t_tot</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;voronoi_full_radial3&#39;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="load-the-coil-sensitivity-matrix">
<h3>Load the Coil Sensitivity Matrix<a class="headerlink" href="#load-the-coil-sensitivity-matrix" title="Link to this heading">¶</a></h3>
<p>Resize the coil sensitivity matrix to match the reconstruction matrix size.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Here we want to clarify the distinction of the concepts between “Reconstruction matrix size” and “Acquisition matrix size”</p>
<ul>
<li><p>Acquisition matrix size: This refers to the matrix size specified by the acquisition protocol. It was already set at the acquisition step by the experimenters.</p></li>
<li><p>Reconstruction matrix size <cite>Matrix_size</cite>: This is set by the user based on the desired resolution of reconstructed images, i.e. the size of the reconstructed image.</p></li>
<li><p>N_u: The size of reconstruction grid in Fourier space. For example, we can set <cite>N_u = Matrix_size</cite>.</p>
<blockquote>
<div><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(N_u = [N_x, N_y, N_z]\)</span></p></li>
</ul>
</div></blockquote>
</li>
<li><p>n_u: The size of reconstruction in image space. It is possible to set <cite>n_u ≤ N_u</cite>. However, we recommend setting <cite>n_u = N_u</cite> for achieving the optimal image quality.</p>
<blockquote>
<div><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(n_u = [n_x, n_y, n_z]\)</span></p></li>
</ul>
</div></blockquote>
</li>
<li><dl class="simple">
<dt>dK_u: The step size of the grid in Fourier space, calculated as <cite>dK_u = 1/Fov</cite>.</dt><dd><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(dK_u = [dK_x, dK_y, dK_z]\)</span></p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">load</span><span class="p">(</span><span class="n">CMatPath</span><span class="p">);</span>
<span class="c">% n_u: reconstruction matrix size</span>
<span class="n">C</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">bmImResize</span><span class="p">(</span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">48</span><span class="p">,</span><span class="w"> </span><span class="mi">48</span><span class="p">,</span><span class="w"> </span><span class="mi">48</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="n">N_u</span><span class="p">,</span><span class="w"> </span><span class="n">N_u</span><span class="p">,</span><span class="w"> </span><span class="n">N_u</span><span class="p">]);</span>
</pre></div>
</div>
</section>
<section id="normalize-the-data">
<h3>Normalize the data<a class="headerlink" href="#normalize-the-data" title="Link to this heading">¶</a></h3>
<p>Normalize the raw data by the average value of a region of interest (ROI). The goal is to adjust the intensity values of the image so that they are centered around a mean of 1 in the ROI.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Keep in mind that whether or not normalization is applied, the regularization weight in the final reconstruction step should be adjusted accordingly. Our normalization helps standardize the regularization weight.</p>
</div>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">x_tot</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">bmMathilda</span><span class="p">(</span><span class="n">y_tot</span><span class="p">,</span><span class="w"> </span><span class="n">t_tot</span><span class="p">,</span><span class="w"> </span><span class="n">ve_tot</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">,</span><span class="w"> </span><span class="n">N_u</span><span class="p">,</span><span class="w"> </span><span class="n">n_u</span><span class="p">,</span><span class="w"> </span><span class="n">dK_u</span><span class="p">);</span>
<span class="n">bmImage</span><span class="p">(</span><span class="n">x_tot</span><span class="p">);</span>
<span class="n">temp_im</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">getimage</span><span class="p">(</span><span class="nb">gca</span><span class="p">);</span>
<span class="n">bmImage</span><span class="p">(</span><span class="n">temp_im</span><span class="p">);</span>
<span class="n">temp_roi</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">roipoly</span><span class="p">;</span>
</pre></div>
</div>
<p>Here an estimation of the reconstructed image will be shown and you can select the ROI based on it.</p>
<p>We selected the left eye globe as the ROI in our example below, you can also select yours with a larger area in the brain.</p>
<ul class="simple">
<li><p>Left Click: Adds a vertex at the clicked position.</p></li>
<li><p>Right Click/Double Click: Completes the polygon and closes it automatically.</p></li>
</ul>
<img alt="_images/select_roi_combined.png" src="_images/select_roi_combined.png" />
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">normalize_val</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">mean</span><span class="p">(</span><span class="n">temp_im</span><span class="p">(</span><span class="n">temp_roi</span><span class="p">(:)));</span>
<span class="c">% normalize it only once</span>
<span class="n">y_tot</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">y_tot</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">normalize_val</span><span class="p">;</span>
</pre></div>
</div>
</section>
<section id="cleaning-of-the-mask">
<h3>Cleaning of the mask<a class="headerlink" href="#cleaning-of-the-mask" title="Link to this heading">¶</a></h3>
<p>For some trajectories, such as the 3D radial trajectory, it is necessary to clean the SI projection and remove the first unsteady shots from the acquired readouts. Therefore, we also need to clean the binning mask accordingly to ensure that the size of <cite>Mask</cite> matches the size of <cite>y_tot</cite>.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="nb">load</span><span class="p">(</span><span class="n">MaskPath</span><span class="p">);</span>
<span class="n">Mask</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">reshape</span><span class="p">(</span><span class="n">Mask</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">22</span><span class="p">,</span><span class="w"> </span><span class="mi">2055</span><span class="p">]);</span>
<span class="c">% before cleaning, the size of Mask: [nBin, nSeg, nShot]</span>
<span class="n">Mask</span><span class="p">(:,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="p">:)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span>
<span class="n">Mask</span><span class="p">(:,</span><span class="w"> </span><span class="p">:,</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">p</span><span class="p">.</span><span class="n">nShot_off</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span>
<span class="c">% after cleaning, the size of Mask: [nBin, nSeg-1, nShot-p.nShot_off]</span>
<span class="n">Mask</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">bmPointReshape</span><span class="p">(</span><span class="n">Mask</span><span class="p">);</span>
<span class="c">% after the reshape, the size of Mask: [nBin, nLines]</span>
<span class="c">% where nLines=(nSeg-1)*(nShot-p.nShot_off)</span>
</pre></div>
</div>
</section>
<section id="compute-final-data-structures-for-reconstruction">
<h3>Compute Final Data Structures for Reconstruction<a class="headerlink" href="#compute-final-data-structures-for-reconstruction" title="Link to this heading">¶</a></h3>
<p>Run the <cite>bmMitosis</cite> function and compute the final volume elements.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">bmMitosis</span><span class="p">(</span><span class="n">y_tot</span><span class="p">,</span><span class="w"> </span><span class="n">t_tot</span><span class="p">,</span><span class="w"> </span><span class="n">Mask</span><span class="p">);</span>
<span class="n">y</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">bmPermuteToCol</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
<span class="n">ve</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">bmVolumeElement</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;voronoi_full_radial3&#39;</span><span class="p">);</span>
</pre></div>
</div>
</section>
<section id="save-the-results">
<h3>Save the Results<a class="headerlink" href="#save-the-results" title="Link to this heading">¶</a></h3>
<p>Save the computed data structures to disk. These will be used for the final reconstruction.</p>
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">bmMitosius_create</span><span class="p">(</span><span class="n">mitosiusPath</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="n">ve</span><span class="p">);</span>
</pre></div>
</div>
</section>
</section>
<section id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>Ensure all paths are correctly set according to your system.</p></li>
<li><p>If you encounter issues with function calls (e.g., <cite>bmTwix</cite>, <cite>bmTraj</cite>), verify that the necessary scripts or external toolboxes are added to the MATLAB path.</p></li>
<li><p>The raw data normalization step ensures that the average value in the selected ROI ranges around the mean of 1 in the reconstructed images. This allows the standardization of the regularization weights.</p></li>
</ul>
</section>
<section id="using-a-custom-acquisition-trajectory">
<span id="custom-acquisition"></span><h2>Using a Custom Acquisition Trajectory<a class="headerlink" href="#using-a-custom-acquisition-trajectory" title="Link to this heading">¶</a></h2>
<p>You can use any trajectory with our reconstruction as long as you can provide the volume elements (inverse density compensation)
for your trajectory. These volume elements can be estimated by one of our volume-element functions if your trajectory is supported by Monalisa.
Else you have to implement your own volume-element function.</p>
<p>You can create your own custom trajectory as long as you follows the following rule:</p>
<blockquote>
<div><p>The trajectory points in k-space must be given in physical units according to your FoV.</p>
</div></blockquote>
<p>Examples:</p>
<blockquote>
<div><ul class="simple">
<li><ol class="arabic simple">
<li><p>If your acquisiton trajectory corresponds to a FoV of <code class="docutils literal notranslate"><span class="pre">[200,</span> <span class="pre">300]</span></code> in <cite>mm</cite> (milimeter), the step size in <cite>kx</cite>-direction of k-space must then be 1/200 (in <cite>1/mm</cite>), and the step size in <cite>ky</cite>-direction of k-space must be 1/300 (in <cite>1/mm</cite>).</p></li>
</ol>
</li>
<li><ol class="arabic simple" start="2">
<li><p>If your acquisiton trajectory is a radial trajectory for a FoV of <code class="docutils literal notranslate"><span class="pre">[360,</span> <span class="pre">360]</span></code> in <cite>mm</cite>, the space between two consecutive points on a radial trajectory line must be <cite>1/360</cite> (in <cite>1/mm</cite>).</p></li>
</ol>
</li>
</ul>
</div></blockquote>
<br><br><img alt="_images/trajectory_ct_radial.png" src="_images/trajectory_ct_radial.png" />
<br><br><br><br><p>If you already computed your trajectory and that it is scalled in the unit-cube (between <cite>-0.5</cite> and <cite>+0.5</cite> in each direction), you can make the
following rescaling to adapt your trejectory for Monalisa.</p>
<dl class="simple">
<dt>For that you need to identify:</dt><dd><ul class="simple">
<li><p>the true acquisition matrix size <span class="math notranslate nohighlight">\([aN_x, aN_y, aN_z]\)</span> i.e. the one that corresponds to your raw data, not the one that appears on the scanner interface.</p></li>
<li><p>the true acquisition field of view <span class="math notranslate nohighlight">\([aL_x, aL_y, aL_z]\)</span> i.e. the one without croping, as it can be done on images reconstructed on the scanner if you chose to acquire with some “over-sampling”.</p></li>
</ul>
</dd>
</dl>
<p>Let then be <span class="math notranslate nohighlight">\([k_x, k_y, k_z]\)</span> the coordinate of a trajectory point. Then rescale it as</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\([k_x, k_y, k_z] \rightarrow [k_x \cdot aN_x/aL_x, \quad  k_y \cdot aN_y/aL_y,  \quad k_z \cdot aN_z/aL_z]\)</span></p>
</div></blockquote>
<p>In another scenario, you may already have your trajectory with the convention that <span class="math notranslate nohighlight">\(k_x\)</span> is scalled between <span class="math notranslate nohighlight">\(-aN_x/2\)</span> and <span class="math notranslate nohighlight">\(aN_x/2 - 1\)</span> and <span class="math notranslate nohighlight">\(k_y, k_z\)</span> are scalled acoordingly.
Then you can simply rescal your trajectory as</p>
<blockquote>
<div><p><span class="math notranslate nohighlight">\([k_x, k_y, k_z] \rightarrow [k_x/aL_x, \quad  k_y/aL_y, \quad  k_z/aL_z]\)</span></p>
</div></blockquote>
<p>The trajectory is not a reconstruction quantity in the sense that it cannot be chosen flexibly for the reconstruction. It is an acquisition quantity that
is set at acquisition and cannot be changed anymore. We have thus to guess how the scanner defined the trajectory. There is no algorithm for that because it
depends on arbitrary conventions used on each MRI scanner.</p>
<p>We don’t work with arbitray units in Monalisa. For example, we do not admit that the edge length of voxels is 1, which corresponds to a scaling ot the
trajectory in the unit-cube. This strategy of working with physical (non-arbitrary) units allows for example to work with different voxel-size for
the same data without having scaling problems in the reconstructed images.</p>
</section>
</section>


          </div>
          
        </div>
      </div>  <!-- This includes the original document content -->

    <!-- Back to Top Button -->
    <button onclick="scrollToTop()" id="back-to-top" title="Go to top">↑</button>
  </div>

      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Monalisa</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="1_quick_start.html">Quick Start</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="2_contents.html">Contents</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="2-1_introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-2_reconstruction_calls.html">Reconstruction Calls</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The Mitosius</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l3"><a class="reference internal" href="#usage-instructions">Usage instructions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#notes">Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-a-custom-acquisition-trajectory">Using a Custom Acquisition Trajectory</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="2-4_binning_masks.html">Binning: Flexible Readout Rearrangement</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-5_coil_sensitivity_map.html">Coil Sensitivity Map Estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-6_prescan_acquisition.html">Acquisition Guidelines for Coil Sensitivity Estimation using Prescans</a></li>
<li class="toctree-l2"><a class="reference internal" href="2-7_discussion.html">Discussion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="3_examples.html">Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="4_api.html">API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="5_docker.html">Docker for Monalisa</a></li>
<li class="toctree-l1"><a class="reference internal" href="6_ack_contribution.html">Acknowledgment and Authors</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="2_contents.html">Contents</a><ul>
      <li>Previous: <a href="2-2_reconstruction_calls.html" title="previous chapter">Reconstruction Calls</a></li>
      <li>Next: <a href="2-4_binning_masks.html" title="next chapter">Binning: Flexible Readout Rearrangement</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Bastien Milani.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/2-3_mitosius_prepare.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>